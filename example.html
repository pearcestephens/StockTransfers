<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Transfers API - Example Usage</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Example: Manually set outlet context and tokens -->
    <!-- In production, these would be dynamically generated by PHP based on current outlet -->
    <script>
        // Example tokens - these would be set by PHP TokenInjector in real implementation
        window.CURRENT_OUTLET_ID = 'store_001';
        
        // NZ Post tokens (example - use your real tokens)
        window.NZPOST_SUBSCRIPTION_KEY = 'ad1bd29013ea4b56ab2036f4d1dabb0b';
        window.NZPOST_API_KEY = 'c9ab68a9c1f74c688e00880d61fd790a';
        
        // GSS/NZ Couriers token (example - use your real token)
        window.GSS_TOKEN = 'suppo-6029-93353FCA505E0FC540F3616962041535328E2AB';
    </script>
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-12">
                <h1 class="mb-4">Stock Transfers API - Live Demo</h1>
                
                <!-- API Status Card -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>API Authentication Status</h5>
                    </div>
                    <div class="card-body">
                        <button id="checkAuthBtn" class="btn btn-primary">Check Auth Status</button>
                        <div id="authStatus" class="mt-3"></div>
                    </div>
                </div>
                
                <!-- Freight Rates Card -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>Get Freight Rates</h5>
                    </div>
                    <div class="card-body">
                        <form id="ratesForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>From Address</h6>
                                    <input type="text" class="form-control mb-2" name="from_address" placeholder="From Address" value="123 Queen Street, Auckland">
                                    <input type="text" class="form-control mb-2" name="from_suburb" placeholder="Suburb" value="Auckland Central">
                                    <input type="text" class="form-control mb-2" name="from_city" placeholder="City" value="Auckland">
                                    <input type="text" class="form-control mb-2" name="from_postcode" placeholder="Postcode" value="1010">
                                </div>
                                <div class="col-md-6">
                                    <h6>To Address</h6>
                                    <input type="text" class="form-control mb-2" name="to_address" placeholder="To Address" value="456 Colombo Street, Christchurch">
                                    <input type="text" class="form-control mb-2" name="to_suburb" placeholder="Suburb" value="Christchurch Central">
                                    <input type="text" class="form-control mb-2" name="to_city" placeholder="City" value="Christchurch">
                                    <input type="text" class="form-control mb-2" name="to_postcode" placeholder="Postcode" value="8011">
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-4">
                                    <input type="number" class="form-control" name="weight" placeholder="Weight (kg)" value="2.5" step="0.1">
                                </div>
                                <div class="col-md-4">
                                    <select class="form-control" name="carrier">
                                        <option value="">All Carriers</option>
                                        <option value="nzpost">NZ Post</option>
                                        <option value="gss">GSS/NZ Couriers</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <button type="submit" class="btn btn-success">Get Rates</button>
                                </div>
                            </div>
                        </form>
                        <div id="ratesResult" class="mt-3"></div>
                    </div>
                </div>
                
                <!-- Address Validation Card -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>Address Validation</h5>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <input type="text" class="form-control" id="addressInput" placeholder="Enter address to validate" value="123 Queen Street, Auckland 1010">
                            <button class="btn btn-outline-secondary" id="validateAddressBtn">Validate</button>
                        </div>
                        <div id="addressResult" class="mt-3"></div>
                    </div>
                </div>
                
                <!-- Tracking Card -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>Track Shipment</h5>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <input type="text" class="form-control" id="trackingInput" placeholder="Enter tracking number">
                            <select class="form-select" id="trackingCarrier">
                                <option value="nzpost">NZ Post</option>
                                <option value="gss">GSS/NZ Couriers</option>
                            </select>
                            <button class="btn btn-outline-secondary" id="trackBtn">Track</button>
                        </div>
                        <div id="trackingResult" class="mt-3"></div>
                    </div>
                </div>
                
                <!-- Services Card -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>Available Services</h5>
                    </div>
                    <div class="card-body">
                        <button id="getServicesBtn" class="btn btn-info">Get Available Services</button>
                        <div id="servicesResult" class="mt-3"></div>
                    </div>
                </div>
                
                <!-- Debug Log -->
                <div class="card">
                    <div class="card-header">
                        <h5>Debug Log</h5>
                        <button class="btn btn-sm btn-secondary float-end" id="clearLogBtn">Clear</button>
                    </div>
                    <div class="card-body">
                        <pre id="debugLog" style="height: 300px; overflow-y: auto; background: #f8f9fa; padding: 10px;"></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Stock Transfers API Client -->
    <script src="assets/js/api-client.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const debugLog = document.getElementById('debugLog');
            
            function addToLog(message, data = {}) {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = `[${timestamp}] ${message}\n${JSON.stringify(data, null, 2)}\n\n`;
                debugLog.textContent += logEntry;
                debugLog.scrollTop = debugLog.scrollHeight;
            }
            
            function displayResult(elementId, result) {
                const element = document.getElementById(elementId);
                if (result.success) {
                    element.innerHTML = `<div class="alert alert-success"><pre>${JSON.stringify(result, null, 2)}</pre></div>`;
                } else {
                    element.innerHTML = `<div class="alert alert-danger"><strong>Error:</strong> ${result.error || 'Unknown error'}</div>`;
                }
            }
            
            // Check Auth Status
            document.getElementById('checkAuthBtn').addEventListener('click', async function() {
                try {
                    addToLog('Checking authentication status...');
                    const result = await window.StockTransfersAPI.checkAuthStatus();
                    addToLog('Auth Status Result', result);
                    displayResult('authStatus', result);
                } catch (error) {
                    addToLog('Auth Status Error', { error: error.message });
                    document.getElementById('authStatus').innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
                }
            });
            
            // Get Rates
            document.getElementById('ratesForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                const formData = new FormData(e.target);
                const rateData = {
                    from_address: {
                        address: formData.get('from_address'),
                        suburb: formData.get('from_suburb'),
                        city: formData.get('from_city'),
                        postcode: formData.get('from_postcode')
                    },
                    to_address: {
                        address: formData.get('to_address'),
                        suburb: formData.get('to_suburb'),
                        city: formData.get('to_city'),
                        postcode: formData.get('to_postcode')
                    },
                    parcels: [{
                        weight: parseFloat(formData.get('weight')),
                        dimensions: { length: 30, width: 20, height: 10 }
                    }]
                };
                
                try {
                    addToLog('Getting freight rates...', rateData);
                    const result = await window.StockTransfersAPI.getRates(rateData, formData.get('carrier') || null);
                    addToLog('Rates Result', result);
                    displayResult('ratesResult', result);
                } catch (error) {
                    addToLog('Rates Error', { error: error.message });
                    document.getElementById('ratesResult').innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
                }
            });
            
            // Validate Address
            document.getElementById('validateAddressBtn').addEventListener('click', async function() {
                const address = document.getElementById('addressInput').value;
                if (!address) return;
                
                try {
                    addToLog('Validating address...', { address });
                    const result = await window.StockTransfersAPI.validateAddress(address);
                    addToLog('Address Validation Result', result);
                    displayResult('addressResult', result);
                } catch (error) {
                    addToLog('Address Validation Error', { error: error.message });
                    document.getElementById('addressResult').innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
                }
            });
            
            // Track Shipment
            document.getElementById('trackBtn').addEventListener('click', async function() {
                const trackingNumber = document.getElementById('trackingInput').value;
                const carrier = document.getElementById('trackingCarrier').value;
                if (!trackingNumber) return;
                
                try {
                    addToLog('Tracking shipment...', { trackingNumber, carrier });
                    const result = await window.StockTransfersAPI.trackShipment(trackingNumber, carrier);
                    addToLog('Tracking Result', result);
                    displayResult('trackingResult', result);
                } catch (error) {
                    addToLog('Tracking Error', { error: error.message });
                    document.getElementById('trackingResult').innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
                }
            });
            
            // Get Services
            document.getElementById('getServicesBtn').addEventListener('click', async function() {
                try {
                    addToLog('Getting available services...');
                    const result = await window.StockTransfersAPI.getServices();
                    addToLog('Services Result', result);
                    displayResult('servicesResult', result);
                } catch (error) {
                    addToLog('Services Error', { error: error.message });
                    document.getElementById('servicesResult').innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
                }
            });
            
            // Clear Log
            document.getElementById('clearLogBtn').addEventListener('click', function() {
                debugLog.textContent = '';
            });
            
            // Auto-check auth status on load
            setTimeout(() => {
                document.getElementById('checkAuthBtn').click();
            }, 1000);
            
            addToLog('Page loaded, API client initialized');
        });
    </script>
</body>
</html>